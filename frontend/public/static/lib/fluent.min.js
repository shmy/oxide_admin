!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("@fluent/bundle",["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).FluentBundle={})}(this,(function(e){"use strict";class t{constructor(e){this.value=e}valueOf(){return this.value}}class r extends t{constructor(e="???"){super(e)}toString(e){return`{${this.value}}`}}class n extends t{constructor(e,t={}){super(e),this.opts=t}toString(e){try{return e.memoizeIntlObject(Intl.NumberFormat,this.opts).format(this.value)}catch(t){return e.reportError(t),this.value.toString(10)}}}class s extends t{constructor(e,t={}){super(e),this.opts=t}toString(e){try{return e.memoizeIntlObject(Intl.DateTimeFormat,this.opts).format(this.value)}catch(t){return e.reportError(t),new Date(this.value).toISOString()}}}function o(e,t,r){if(r===t)return!0;if(r instanceof n&&t instanceof n&&r.value===t.value)return!0;if(t instanceof n&&"string"==typeof r){if(r===e.memoizeIntlObject(Intl.PluralRules,t.opts).select(t.value))return!0}return!1}function i(e,t,n){return t[n]?c(e,t[n].value):(e.reportError(new RangeError("No default")),new r)}function a(e,t){const r=[],n=Object.create(null);for(const s of t)"narg"===s.type?n[s.name]=u(e,s.value):r.push(u(e,s));return{positional:r,named:n}}function u(e,l){switch(l.type){case"str":return l.value;case"num":return new n(l.value,{minimumFractionDigits:l.precision});case"var":return function(e,{name:o}){let i;if(e.params){if(!Object.prototype.hasOwnProperty.call(e.params,o))return new r(`$${o}`);i=e.params[o]}else{if(!e.args||!Object.prototype.hasOwnProperty.call(e.args,o))return e.reportError(new ReferenceError(`Unknown variable: $${o}`)),new r(`$${o}`);i=e.args[o]}if(i instanceof t)return i;switch(typeof i){case"string":return i;case"number":return new n(i);case"object":if(i instanceof Date)return new s(i.getTime());default:return e.reportError(new TypeError(`Variable type not supported: $${o}, ${typeof i}`)),new r(`$${o}`)}}(e,l);case"mesg":return function(e,{name:t,attr:n}){const s=e.bundle._messages.get(t);if(!s)return e.reportError(new ReferenceError(`Unknown message: ${t}`)),new r(t);if(n){const o=s.attributes[n];return o?c(e,o):(e.reportError(new ReferenceError(`Unknown attribute: ${n}`)),new r(`${t}.${n}`))}if(s.value)return c(e,s.value);return e.reportError(new ReferenceError(`No value: ${t}`)),new r(t)}(e,l);case"term":return function(e,{name:t,attr:n,args:s}){const o=`-${t}`,i=e.bundle._terms.get(o);if(!i)return e.reportError(new ReferenceError(`Unknown term: ${o}`)),new r(o);if(n){const t=i.attributes[n];if(t){e.params=a(e,s).named;const r=c(e,t);return e.params=null,r}return e.reportError(new ReferenceError(`Unknown attribute: ${n}`)),new r(`${o}.${n}`)}e.params=a(e,s).named;const u=c(e,i.value);return e.params=null,u}(e,l);case"func":return function(e,{name:t,args:n}){let s=e.bundle._functions[t];if(!s)return e.reportError(new ReferenceError(`Unknown function: ${t}()`)),new r(`${t}()`);if("function"!=typeof s)return e.reportError(new TypeError(`Function ${t}() is not callable`)),new r(`${t}()`);try{let t=a(e,n);return s(t.positional,t.named)}catch(n){return e.reportError(n),new r(`${t}()`)}}(e,l);case"select":return function(e,{selector:t,variants:n,star:s}){let a=u(e,t);if(a instanceof r)return i(e,n,s);for(const t of n){if(o(e,a,u(e,t.key)))return c(e,t.value)}return i(e,n,s)}(e,l);default:return new r}}function l(e,t){if(e.dirty.has(t))return e.reportError(new RangeError("Cyclic reference")),new r;e.dirty.add(t);const n=[],s=e.bundle._useIsolating&&t.length>1;for(const r of t)if("string"!=typeof r){if(e.placeables++,e.placeables>100)throw e.dirty.delete(t),new RangeError(`Too many placeables expanded: ${e.placeables}, max allowed is 100`);s&&n.push("⁨"),n.push(u(e,r).toString(e)),s&&n.push("⁩")}else n.push(e.bundle._transform(r));return e.dirty.delete(t),n.join("")}function c(e,t){return"string"==typeof t?e.bundle._transform(t):l(e,t)}class f{constructor(e,t,r){this.dirty=new WeakSet,this.params=null,this.placeables=0,this.bundle=e,this.errors=t,this.args=r}reportError(e){if(!(this.errors&&e instanceof Error))throw e;this.errors.push(e)}memoizeIntlObject(e,t){let r=this.bundle._intls.get(e);r||(r={},this.bundle._intls.set(e,r));let n=JSON.stringify(t);return r[n]||(r[n]=new e(this.bundle.locales,t)),r[n]}}function p(e,t){const r=Object.create(null);for(const[n,s]of Object.entries(e))t.includes(n)&&(r[n]=s.valueOf());return r}const h=["unitDisplay","currencyDisplay","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits"];function m(e,t){let o=e[0];if(o instanceof r)return new r(`NUMBER(${o.valueOf()})`);if(o instanceof n)return new n(o.valueOf(),{...o.opts,...p(t,h)});if(o instanceof s)return new n(o.valueOf(),{...p(t,h)});throw new TypeError("Invalid argument to NUMBER")}const w=["dateStyle","timeStyle","fractionalSecondDigits","dayPeriod","hour12","weekday","era","year","month","day","hour","minute","second","timeZoneName"];function y(e,t){let o=e[0];if(o instanceof r)return new r(`DATETIME(${o.valueOf()})`);if(o instanceof s)return new s(o.valueOf(),{...o.opts,...p(t,w)});if(o instanceof n)return new s(o.valueOf(),{...p(t,w)});throw new TypeError("Invalid argument to DATETIME")}const d=new Map;const g=/^(-?[a-zA-Z][\w-]*) *= */gm,E=/\.([a-zA-Z][\w-]*) *= */y,v=/\*?\[/y,b=/(-?[0-9]+(?:\.([0-9]+))?)/y,x=/([a-zA-Z][\w-]*)/y,$=/([$-])?([a-zA-Z][\w-]*)(?:\.([a-zA-Z][\w-]*))?/y,S=/^[A-Z][A-Z0-9_-]*$/,I=/([^{}\n\r]+)/y,O=/([^\\"\n\r]*)/y,_=/\\([\\"])/y,A=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{6})/y,F=/^\n+/,T=/ +$/,D=/ *\r?\n/g,R=/( *)$/,j=/{\s*/y,U=/\s*}/y,k=/\[\s*/y,M=/\s*] */y,N=/\s*\(\s*/y,z=/\s*->\s*/y,Z=/\s*:\s*/y,P=/\s*,?\s*/y,B=/\s+/y;class C{constructor(e,t){this.value=e,this.length=t}}e.FluentBundle=class{constructor(e,{functions:t,useIsolating:r=!0,transform:n=(e=>e)}={}){this._terms=new Map,this._messages=new Map,this.locales=Array.isArray(e)?e:[e],this._functions={NUMBER:m,DATETIME:y,...t},this._useIsolating=r,this._transform=n,this._intls=function(e){const t=Array.isArray(e)?e.join(" "):e;let r=d.get(t);return void 0===r&&(r=new Map,d.set(t,r)),r}(e)}hasMessage(e){return this._messages.has(e)}getMessage(e){return this._messages.get(e)}addResource(e,{allowOverrides:t=!1}={}){const r=[];for(let n=0;n<e.body.length;n++){let s=e.body[n];if(s.id.startsWith("-")){if(!1===t&&this._terms.has(s.id)){r.push(new Error(`Attempt to override an existing term: "${s.id}"`));continue}this._terms.set(s.id,s)}else{if(!1===t&&this._messages.has(s.id)){r.push(new Error(`Attempt to override an existing message: "${s.id}"`));continue}this._messages.set(s.id,s)}}return r}formatPattern(e,t=null,n=null){if("string"==typeof e)return this._transform(e);let s=new f(this,n,t);try{return l(s,e).toString(s)}catch(e){if(s.errors&&e instanceof Error)return s.errors.push(e),(new r).toString(s);throw e}}},e.FluentDateTime=s,e.FluentNone=r,e.FluentNumber=n,e.FluentResource=class{constructor(e){this.body=[],g.lastIndex=0;let t=0;for(;;){let r=g.exec(e);if(null===r)break;t=g.lastIndex;try{this.body.push(a(r[1]))}catch(e){if(e instanceof SyntaxError)continue;throw e}}function r(r){return r.lastIndex=t,r.test(e)}function n(r,n){if(e[t]===r)return t++,!0;if(n)throw new n(`Expected ${r}`);return!1}function s(e,n){if(r(e))return t=e.lastIndex,!0;if(n)throw new n(`Expected ${e.toString()}`);return!1}function o(r){r.lastIndex=t;let n=r.exec(e);if(null===n)throw new SyntaxError(`Expected ${r.toString()}`);return t=r.lastIndex,n}function i(e){return o(e)[1]}function a(e){let t=u(),n=function(){let e=Object.create(null);for(;r(E);){let t=i(E),r=u();if(null===r)throw new SyntaxError("Expected attribute value");e[t]=r}return e}();if(null===t&&0===Object.keys(n).length)throw new SyntaxError("Expected message value or attributes");return{id:e,value:t,attributes:n}}function u(){let n;if(r(I)&&(n=i(I)),"{"===e[t]||"}"===e[t])return l(n?[n]:[],1/0);let s=d();return s?n?l([n,s],s.length):(s.value=W(s.value,F),l([s],s.length)):n?W(n,T):null}function l(n=[],s){for(;;){if(r(I)){n.push(i(I));continue}if("{"===e[t]){n.push(c());continue}if("}"===e[t])throw new SyntaxError("Unbalanced closing brace");let o=d();if(!o)break;n.push(o),s=Math.min(s,o.length)}let o=n.length-1,a=n[o];"string"==typeof a&&(n[o]=W(a,T));let u=[];for(let e of n)e instanceof C&&(e=e.value.slice(0,e.value.length-s)),e&&u.push(e);return u}function c(){s(j,SyntaxError);let e=f();if(s(U))return e;if(s(z)){let t=function(){let e,t=[],s=0;for(;r(v);){n("*")&&(e=s);let r=h(),o=u();if(null===o)throw new SyntaxError("Expected variant value");t[s++]={key:r,value:o}}if(0===s)return null;if(void 0===e)throw new SyntaxError("Expected default variant");return{variants:t,star:e}}();return s(U,SyntaxError),{type:"select",selector:e,...t}}throw new SyntaxError("Unclosed placeable")}function f(){if("{"===e[t])return c();if(r($)){let[,r,n,i=null]=o($);if("$"===r)return{type:"var",name:n};if(s(N)){let o=function(){let r=[];for(;;){switch(e[t]){case")":return t++,r;case void 0:throw new SyntaxError("Unclosed argument list")}r.push(p()),s(P)}}();if("-"===r)return{type:"term",name:n,attr:i,args:o};if(S.test(n))return{type:"func",name:n,args:o};throw new SyntaxError("Function names must be all upper-case")}return"-"===r?{type:"term",name:n,attr:i,args:[]}:{type:"mesg",name:n,attr:i}}return m()}function p(){let e=f();return"mesg"!==e.type?e:s(Z)?{type:"narg",name:e.name,value:m()}:e}function h(){let e;return s(k,SyntaxError),e=r(b)?w():{type:"str",value:i(x)},s(M,SyntaxError),e}function m(){if(r(b))return w();if('"'===e[t])return function(){n('"',SyntaxError);let r="";for(;;){if(r+=i(O),"\\"!==e[t]){if(n('"'))return{type:"str",value:r};throw new SyntaxError("Unclosed string literal")}r+=y()}}();throw new SyntaxError("Invalid expression")}function w(){let[,e,t=""]=o(b),r=t.length;return{type:"num",value:parseFloat(e),precision:r}}function y(){if(r(_))return i(_);if(r(A)){let[,e,t]=o(A),r=parseInt(e||t,16);return r<=55295||57344<=r?String.fromCodePoint(r):"�"}throw new SyntaxError("Unknown escape sequence")}function d(){let r=t;switch(s(B),e[t]){case".":case"[":case"*":case"}":case void 0:return!1;case"{":return q(e.slice(r,t))}return" "===e[t-1]&&q(e.slice(r,t))}function W(e,t){return e.replace(t,"")}function q(e){let t=e.replace(D,"\n"),r=R.exec(e)[1].length;return new C(t,r)}}},e.FluentType=t}));