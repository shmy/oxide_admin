[package]
name = "server"
version = "0.1.0"
edition = "2024"

[lib]
path = "lib.rs"

[[bin]]
name = "server"
path = "main.rs"

[features]
default = ["kv_redb", "bg_dummy", "object_storage_fs", "trace_console"]
kv_redb = ["infrastructure/kv_redb"]
kv_redis = ["infrastructure/kv_redis"]
bg_dummy = ["infrastructure/bg_dummy"]
bg_faktory = ["infrastructure/bg_faktory"]
bg_sqlite = ["infrastructure/bg_sqlite"]
bg_faktory_tls = ["bg_faktory", "infrastructure/bg_faktory_tls"]
object_storage_fs = ["infrastructure/object_storage_fs"]
object_storage_s3 = ["infrastructure/object_storage_s3"]
object_storage_s3_tls = [
    "object_storage_s3",
    "infrastructure/object_storage_s3_tls",
]
trace_console = ["trace_kit/console"]
trace_rolling = ["trace_kit/rolling", "infrastructure/trace_rolling"]
trace_otlp = [
    "trace_kit/otlp",
    "adapter/trace_otlp",
    "infrastructure/trace_otlp",
]
trace_otlp_tls = ["trace_otlp", "trace_kit/otlp_tls"]
sched_tokio_cron = ["dep:sched_kit", "application/sched_tokio_cron"]

[dependencies]
adapter = { workspace = true }
anyhow = { workspace = true }
application = { workspace = true }
axum = { workspace = true }
bg_worker_kit = { workspace = true }
chrono-tz = { workspace = true }
clap = { workspace = true, features = [
    "std",
    "help",
    "env",
    "derive",
    "error-context",
] }
dotenvy = { workspace = true }
humantime = { workspace = true }
infrastructure = { workspace = true }

kvdb_kit = { workspace = true }
mimalloc = { workspace = true }
object_storage_kit = { workspace = true }
sched_kit = { workspace = true, optional = true }
tokio = { workspace = true, features = ["full"] }
trace_kit = { workspace = true }
tracing = { workspace = true }
